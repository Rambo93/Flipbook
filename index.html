<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>The Little Light That Grew – Flipbook</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <link rel="stylesheet" href="https://unpkg.com/stpageflip/dist/css/stpageflip.min.css">
  <style>
    :root { --bg:#0c1230; --bg2:#101a45; --text:#ffffff; --accent:#ffd27a; --muted:#9ab; }
    html,body { height:100%; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; overflow:hidden; }
    #app { position:fixed; inset:0; display:grid; place-items:center; }
    #flipbook { width:min(100vw,1200px); height:min(100vh,90vh); }
    /* Page styling */
    .page { display:flex; align-items:center; justify-content:center; width:100%; height:100%;
      background:linear-gradient(180deg,var(--bg2),var(--bg)); color:var(--text); padding:40px; box-sizing:border-box; text-align:center; }
    .page h1 { font-size: clamp(1.6rem, 4vw, 2.4rem); margin:0 0 1rem; }
    .page p { font-size: clamp(1rem, 2.5vw, 1.25rem); line-height:1.6; margin:0; }
    .glow { text-shadow: 0 0 12px rgba(255,200,80,.8), 0 0 28px rgba(255,160,40,.5); color:var(--accent); }

    /* UI */
    .ui { position:fixed; inset:0; pointer-events:none; }
    .btn { position:absolute; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.18); color:#fff; padding:10px 14px; border-radius:10px; cursor:pointer; pointer-events:auto; backdrop-filter: blur(6px); user-select:none; }
    .btn.prev { left:14px; } .btn.next { right:14px; }
    .hint, .pagecount { position:fixed; left:50%; transform:translateX(-50%); color:var(--muted); font-size:.9rem; pointer-events:none; text-align:center; text-shadow: 0 1px 2px rgba(0,0,0,.25); }
    .hint { bottom:10px; } .pagecount { top:10px; background:rgba(0,0,0,.2); padding:4px 10px; border-radius:999px; }
    .tap-advance { position:fixed; inset:0; pointer-events:auto; background:transparent; }
    @media (prefers-reduced-motion: reduce) { .hint { display:none; } }

    /* Hidden source container for pages (required by loadFromHTML) */
    #pagesSource { display:none; }
  </style>
</head>
<body>
  <div id="app">
    <div id="flipbook" aria-label="Flipbook"></div>
  </div>

  <!-- UI overlay -->
  <div class="ui" aria-hidden="true">
    <div class="btn prev" title="Previous (Left Arrow)">◄</div>
    <div class="btn next" title="Next (Right Arrow)">►</div>
    <div class="pagecount" id="pagecount">1/1</div>
    <div class="hint">Tap/click anywhere, swipe left/right, or use ◄ ►</div>
    <div class="tap-advance" id="tapAdvance"></div>
  </div>

  <!-- Hidden container that will hold actual page elements -->
  <div id="pagesSource"></div>

  <script src="https://unpkg.com/stpageflip/dist/js/stpageflip.min.js"></script>
  <script>
    // Content
    const pages = [
      { title: "The Little Light That Grew", text: "", cover:true },
      { text: "In a quiet village, a little lantern wished it could brighten the night." },
      { text: "“You’re enough,” a child whispered. The lantern warmed a little.", glow:true },
      { text: "Each evening, it glowed for whoever passed by." },
      { text: "It helped small moments—naps, notes, and gentle goodnights." },
      { text: "On windy nights, it trembled—but kept shining." },
      { text: "One by one, others caught the light and shared it.", glow:true },
      { text: "Together, small lights made a bright welcome.", glow:true },
      { text: "Morning found a village changed—by one little light that kept showing up." }
    ];

    // Build real DOM nodes inside #pagesSource so loadFromHTML can parse them
    const source = document.getElementById('pagesSource');
    pages.forEach(p => {
      const page = document.createElement('div');
      page.className = 'page';
      if (p.cover) {
        page.innerHTML = `<div><h1 class="glow">${p.title}</h1><p>by You</p></div>`;
        // Mark cover per library expectations
        page.setAttribute('data-density', 'hard'); // optional but nice for cover
      } else {
        const cls = p.glow ? ' class="glow"' : '';
        page.innerHTML = `<div><p${cls}>${p.text}</p></div>`;
      }
      source.appendChild(page);
    });

    // Init flipbook
    const container = document.getElementById('flipbook');
    const flip = new StPageFlip(container, {
      width: 600,
      height: 800,
      size: 'stretch',
      maxShadowOpacity: 0.25,
      mobileScrollSupport: true,
      drawShadow: true,
      showCover: true,
      useMouseEvents: false
    });

    // Load pages from the hidden DOM container
    flip.loadFromHTML(document.querySelectorAll('#pagesSource .page'));

    // UI Controls
    const prevBtn = document.querySelector('.btn.prev');
    const nextBtn = document.querySelector('.btn.next');
    const pageCountEl = document.getElementById('pagecount');
    const tapAdvance = document.getElementById('tapAdvance');

    function updateCounter() {
      const index = flip.getCurrentPageIndex(); // 0-based visible page index
      const total = flip.getPageCount();        // total pages
      pageCountEl.textContent = `${index + 1}/${total}`;
    }

    flip.on('flip', updateCounter);
    flip.on('init', updateCounter);

    // Buttons
    prevBtn.addEventListener('click', (e)=>{ e.stopPropagation(); flip.flipPrev(); });
    nextBtn.addEventListener('click', (e)=>{ e.stopPropagation(); flip.flipNext(); });

    // Tap/click anywhere to go next (unless selecting text)
    tapAdvance.addEventListener('click', ()=>{
      const selection = window.getSelection && window.getSelection().toString();
      if (!selection) flip.flipNext();
    });

    // Keyboard
    window.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowRight') flip.flipNext();
      if (e.key === 'ArrowLeft') flip.flipPrev();
      if (e.key === 'Home') flip.turnToPage(0);
      if (e.key === 'End') flip.turnToPage(flip.getPageCount() - 1);
    });

    // Touch swipe
    let sx=null, sy=null, t0=0;
    document.addEventListener('touchstart', (e)=>{ const t=e.changedTouches[0]; sx=t.clientX; sy=t.clientY; t0=Date.now(); }, {passive:true});
    document.addEventListener('touchend', (e)=>{
      if (sx==null) return;
      const t=e.changedTouches[0]; const dx=t.clientX-sx; const dy=t.clientY-sy; const dt=Date.now()-t0;
      if (Math.abs(dx)>40 && Math.abs(dx)>Math.abs(dy) && dt<600) { dx<0 ? flip.flipNext() : flip.flipPrev(); }
      sx=sy=null;
    }, {passive:true});

    // Ensure proper layout on resize
    window.addEventListener('resize', ()=> flip.update());

    // Kick initial counter after render
    flip.on('init', ()=> setTimeout(updateCounter, 50));
  </script>
</body>
</html>
